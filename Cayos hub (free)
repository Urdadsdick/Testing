-- New Key System
local keyRequired = "GoatedHub123"  -- The key that must be entered to unlock the script
local keyUrl = "https://discord.gg/ADQUB6W7"  -- Link for "Get Key"

-- Function to initialize the script's features
local function loadScriptFeatures()
    -- Load the Orion library
    local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
    local Window = OrionLib:MakeWindow({
        Name = "Goated Hub - Key System",
        HidePremium = false,
        SaveConfig = true,
        ConfigFolder = "GoatedHub"
    })
    
    -- Player Settings
    local players = game:GetService("Players")
    local plr = players.LocalPlayer
    local workspace = game:GetService("Workspace")
    local replicatedStorage = game:GetService("ReplicatedStorage")

    local settings = {
        walkSpeed = 16,
        godMode = false,
        onePunch = false,
        autoPickup = false,
        autoFarm = false,
        espEnabled = false,
        flyEnabled = false
    }

    -- Utility: Dynamic Random Delay
    local random = Random.new()
    local function rnd(min, max) return random:NextNumber(min, max) end

    -- Function to teleport the player to specific coordinates
    local function teleportToCoordinates(x, y, z)
        local root = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
        if root then
            root.CFrame = CFrame.new(x, y, z)
        end
    end

    --- CORE FUNCTIONS ---
    -- All previous core functions (like dealDamage, enableGodMode, etc.) remain here
    -- No changes made to these.

    --- PLAYER TAB ---
    local playerTab = Window:MakeTab({ Name = "Player", Icon = "rbxassetid://4483345998", PremiumOnly = false })

    -- Walk Speed Slider
    playerTab:AddSlider({
        Name = "Walk Speed",
        Min = 16,
        Max = 100,
        Default = 16,
        Increment = 1,
        Callback = function(value)
            settings.walkSpeed = value
            local character = plr.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then humanoid.WalkSpeed = value end
            end
        end
    })

    -- God Mode Toggle
    playerTab:AddToggle({
        Name = "God Mode",
        Default = false,
        Callback = function(state)
            if state then enableGodMode() else disableGodMode() end
        end
    })

    -- One Punch Toggle
    playerTab:AddToggle({
        Name = "One Punch Kill",
        Default = false,
        Callback = function(state)
            if state then enableOnePunch() else disableOnePunch() end
        end
    })

    --- TELEPORTS TAB ---
    local teleportsTab = Window:MakeTab({ Name = "Teleports", Icon = "rbxassetid://4483345998", PremiumOnly = false })

    teleportsTab:AddButton({
        Name = "Apt2",
        Callback = function()
            teleportToCoordinates(2569.16, 34.81, -115.59)
        end
    })

    --- FARMING TAB ---
    local farmingTab = Window:MakeTab({ Name = "Farming", Icon = "rbxassetid://4483345998", PremiumOnly = false })

    farmingTab:AddToggle({
        Name = "Auto Mop Farm",
        Default = false,
        Callback = function(state)
            settings.autoFarm = state
            while settings.autoFarm do
                local mop = plr.Backpack:FindFirstChild("Mop")
                if mop then
                    local root = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        replicatedStorage.Remote:FireServer(mop, "Use", root.CFrame)
                    end
                end
                wait(rnd(0.1, 0.3))
            end
        end
    })

    farmingTab:AddToggle({
        Name = "Auto Pickup",
        Default = false,
        Callback = function(state)
            if state then enableAutoPickup() else disableAutoPickup() end
        end
    })

    --- ESP TAB ---
    local espTab = Window:MakeTab({ Name = "ESP", Icon = "rbxassetid://4483345998", PremiumOnly = false })

    espTab:AddToggle({
        Name = "Enable ESP",
        Default = false,
        Callback = function(state)
            if state then enableESP() else disableESP() end
        end
    })

    --- FLYING TAB ---
    local flyingTab = Window:MakeTab({ Name = "Flying", Icon = "rbxassetid://4483345998", PremiumOnly = false })
    flyingTab:AddButton({ Name = "Fly", Callback = startFly })
    flyingTab:AddButton({ Name = "Unfly", Callback = stopFly })

    --- CREDITS TAB ---
    local creditsTab = Window:MakeTab({ Name = "Credits", Icon = "rbxassetid://4483345998", PremiumOnly = false })
    creditsTab:AddLabel("Developed by yooo0684 on Discord")
    creditsTab:AddButton({
        Name = "Join Discord",
        Callback = function()
            setclipboard("https://discord.gg/DvgnsUp3")
        end
    })

    -- Initialize the UI
    OrionLib:Init()
end

-- New Key System for Validation
local function keySystem()
    -- Create a simple key prompt
    local prompt = Instance.new("ScreenGui")
    prompt.Name = "KeyPrompt"
    prompt.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    -- Creating a text box for entering the key
    local textBox = Instance.new("TextBox")
    textBox.Parent = prompt
    textBox.Size = UDim2.new(0, 400, 0, 50)
    textBox.Position = UDim2.new(0.5, -200, 0.5, -25)
    textBox.Text = "Enter Key Here"
    textBox.TextColor3 = Color3.new(1, 1, 1)
    textBox.BackgroundTransparency = 0.5
    textBox.BackgroundColor3 = Color3.new(0, 0, 0)

    -- Creating a button to submit the key
    local submitButton = Instance.new("TextButton")
    submitButton.Parent = prompt
    submitButton.Size = UDim2.new(0, 400, 0, 50)
    submitButton.Position = UDim2.new(0.5, -200, 0.5, 30)
    submitButton.Text = "Submit Key"
    submitButton.TextColor3 = Color3.new(1, 1, 1)
    submitButton.BackgroundTransparency = 0.5
    submitButton.BackgroundColor3 = Color3.new(0, 0, 0)

    -- Key submission event
    submitButton.MouseButton1Click:Connect(function()
        if textBox.Text == keyRequired then
            prompt:Destroy()
            loadScriptFeatures()  -- Proceed to load features if key is correct
        else
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "Invalid Key",
                Text = "The key you entered is incorrect.",
                Duration = 5
            })
        end
    end)
end

-- Start the key system
keySystem()
